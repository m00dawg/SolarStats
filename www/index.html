<!DOCTYPE html>
<html>
<head>
<title>Turn Off the Dryer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Bootstrap -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
        <a class="navbar-brand" href="#">Turn Off the Dryer</a>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <br />
    <h1 class="page-header">Solar vs Usage</h1>
    <div class="col-md-6">
        <h2>Overall</h2>
        <canvas id="solarVsUsedPie"></canvas>
    </div>
    <div class="col-md-6">
        <h2>Today</h2>
        <canvas id="solarVsUsedPieToday"></canvas>
    </div>
  </div>

  <div class="row">
    <h1 class="page-header">Fancy Bar Charts</h1>
    <h2>Average Hourly Usage</h2>
    <canvas id="averageHourlyUsageGraph" width="100" height="25"></canvas>
    <h2>Daily Usage</h2>
    <canvas id="dailyUsageGraph" width="100" height="25"></canvas>
  </div>

  <div class="row">
    <h1 class="page-header">Raw Data</h1>
    <h2>Daily Usage</h2>
    <table class="table table-striped table-bordered" id="averageHourlyUsage">
        <tr><th>Day</th><th>Used kWH</th><th>Grid kWH</th><th>Solar kWH</th><th>Average Temp</th></tr>
    </table>
    <br />
    <h2>Average Hourly Usage</h2>
    <table class="table table-striped table-bordered" id="dailyUsage">
        <tr><th>Hour</th><th>Used kWH</th><th>Grid kWH</th><th>Solar kWH</th><th>Average Temp</th></tr>
    </table>
  </div>
</div>

<script src="js/jquery-2.1.4.min.js"></script>
<script src="js/Chart.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>

<script>
  jQuery.ajax({
      type: "GET",
      url: "http://solarstats.moocow.home/api/UsageByDay",
      contentType: "application/json",
      dataType: "json",
      success: displayUsageByDay,
      //error: errorCallback
  });

  jQuery.ajax({
      type: "GET",
      url: "http://solarstats.moocow.home/api/AverageUsageByHour",
      contentType: "application/json",
      dataType: "json",
      success: displayAverageUsageByHour,
      //error: errorCallback
  });

  jQuery.ajax({
      type: "GET",
      url: "http://solarstats.moocow.home/api/TodaysUsageByHour",
      contentType: "application/json",
      dataType: "json",
      success: displayTodaysUsageByHour,
      //error: errorCallback
  });


  function displayUsageByDay(data, status, jqXHR)
  {
    var day = []
    var usedKWH = [];
    var gridKWH = [];
    var solarKWH = [];
    var avgTemp = [];

    var totalUsedKWH = 0;
    var totalSolarKWH = 0;

    if(data.length == 0)
      $("#dailyUsage").append("<tr><td colspan='5'>No Data Found</td></tr>");
    else
    {
      $.each(data, function()
      {
        var f = Math.round(this.AvgTemp * (9/5) + 32)
        $("#dailyUsage").append(
          "<tr><td>" + this.Day +
          "</td><td>" + this.UsedKWH +
          "</td><td>" + this.GridKWH +
          "</td><td>" + this.SolarKWH +
          "</td><td>" + this.AvgTemp + "C (" + f + "F)" +
          "</td></tr>");

         day.push(this.Day);
         usedKWH.push(this.UsedKWH);
         gridKWH.push(this.GridKWH);
         solarKWH.push(this.SolarKWH);
         avgTemp.push(this.AvgTemp);

         totalUsedKWH = totalUsedKWH + parseInt(this.UsedKWH);
         totalSolarKWH = totalSolarKWH + parseInt(this.SolarKWH);
      });
      drawSolarVsUsedPie(totalUsedKWH, totalSolarKWH);
      drawDailyUsageGraph(day, usedKWH, solarKWH);
    }

  }

  function displayAverageUsageByHour(data, status, jqXHR)
  {
    var hour = []
    var usedKWH = [];
    var gridKWH = [];
    var solarKWH = [];
    var outsideTemp = [];

    if(data.length == 0)
      $("#averageHourlyUsage").append("<tr><td colspan='5'>No Data Found</td></tr>");
    else
    {
      $.each(data, function()
      {
        var f = Math.round(this.OutsideTemp * (9/5) + 32)
        $("#averageHourlyUsage").append(
          "<tr><td>" + this.Hour +
          "</td><td>" + this.UsedKWH +
          "</td><td>" + this.GridKWH +
          "</td><td>" + this.SolarKWH +
          "</td><td>" + this.OutsideTemp + "C (" + f + "F)" +
          "</td></tr>");

         hour.push(this.Hour);
         usedKWH.push(this.UsedKWH);
         gridKWH.push(this.GridKWH);
         solarKWH.push(this.SolarKWH);
         outsideTemp.push(this.OutsideTemp);
      });
      drawAverageHourlyUsageGraph(hour, usedKWH, solarKWH);
    }
  }

  function displayTodaysUsageByHour(data, status, jqXHR)
  {
    var hour = []
    var usedKWH = [];
    var gridKWH = [];
    var solarKWH = [];
    var outsideTemp = [];

    var totalUsedKWH = 0;
    var totalSolarKWH = 0;

    if(data.length == 0)
      //$("#averageHourlyUsage").append("<tr><td colspan='5'>No Data Found</td></tr>");
      { }
    else
    {
      $.each(data, function()
      {
        /*
        var f = Math.round(this.OutsideTemp * (9/5) + 32)
        $("#averageHourlyUsage").append(
          "<tr><td>" + this.Hour +
          "</td><td>" + this.UsedKWH +
          "</td><td>" + this.GridKWH +
          "</td><td>" + this.SolarKWH +
          "</td><td>" + this.OutsideTemp + "C (" + f + "F)" +
          "</td></tr>");

         hour.push(this.Hour);
         usedKWH.push(this.UsedKWH);
         gridKWH.push(this.GridKWH);
         solarKWH.push(this.SolarKWH);
         outsideTemp.push(this.OutsideTemp);
         */
         totalUsedKWH = totalUsedKWH + parseFloat(this.UsedKWH);
         totalSolarKWH = totalSolarKWH + parseFloat(this.SolarKWH);
      });
      drawTodaysSolarVsUsedPie(totalUsedKWH, totalSolarKWH);
    }
  }


  function drawDailyUsageGraph(day, usedKWH, solarKWH)
  {
    Chart.defaults.global.responsive = true;
    Chart.defaults.global.maintainAspectRatio = true;
    Chart.defaults.global.tooltipTitleFontSize = 14;
    Chart.defaults.global.tooltipFontSize = 12;
    Chart.defaults.global.scaleFontColor = "#444444";
    Chart.defaults.global.scaleLineColor = "#dddddd";
    Chart.defaults.global.scaleGridLineColor = "#cccccc";

    var dailyUsageGraph = document.getElementById('dailyUsageGraph').getContext('2d');
    var dailyUsageData = {
      labels: day,
      datasets: [
          {
              label: "Used kWH",
              fillColor: "rgba(250,120,120,0.7)",
              strokeColor: "rgba(250,120,120,0.8)",
              highlightFill: "rgba(255,120,120,0.75)",
              highlightStroke: "rgba(255,120,120,1)",
              data: usedKWH
          },
          {
              label: "Solar kWH",
              fillColor: "rgba(120,250,120,0.7)",
              strokeColor: "rgba(120,250,120,0.8)",
              highlightFill: "rgba(120,255,120,0.75)",
              highlightStroke: "rgba(120,255,120,1)",
              data: solarKWH
          },
      ]
    };
    dailyUsageChart = new Chart(dailyUsageGraph).Bar(dailyUsageData);
  };

  function drawSolarVsUsedPie(totalUsedKWH, totalSolarKWH)
  {
    Chart.defaults.global.responsive = true;
    Chart.defaults.global.maintainAspectRatio = true;
    Chart.defaults.global.tooltipTitleFontSize = 14;
    Chart.defaults.global.tooltipFontSize = 12;
    Chart.defaults.global.scaleFontColor = "#444444";
    Chart.defaults.global.scaleLineColor = "#dddddd";
    Chart.defaults.global.scaleGridLineColor = "#cccccc";

    var solarVsUsagePie = document.getElementById('solarVsUsedPie').getContext('2d');
    var solarVsUsageData = [
      {
        value: totalUsedKWH,
        color: "rgba(250,0,0,0.5)",
        highlight: "rgba(255, 0, 0, 0.75)",
        label: "Used"
      },
      {
        value: totalSolarKWH,
        color: "rgba(0,250,0,0.5)",
        highlight: "rgba(0, 255, 0, 0.75)",
        label: "Solar"
      }
    ];

    solarVsUsagePieChart = new Chart(solarVsUsagePie).Pie(solarVsUsageData);
  };

  function drawTodaysSolarVsUsedPie(totalUsedKWH, totalSolarKWH)
  {
    Chart.defaults.global.responsive = true;
    Chart.defaults.global.maintainAspectRatio = true;
    Chart.defaults.global.tooltipTitleFontSize = 14;
    Chart.defaults.global.tooltipFontSize = 12;
    Chart.defaults.global.scaleFontColor = "#444444";
    Chart.defaults.global.scaleLineColor = "#dddddd";
    Chart.defaults.global.scaleGridLineColor = "#cccccc";

    var solarVsUsagePie = document.getElementById('solarVsUsedPieToday').getContext('2d');
    var solarVsUsageData = [
      {
        value: totalUsedKWH,
        color: "rgba(250,0,0,0.5)",
        highlight: "rgba(255, 0, 0, 0.75)",
        label: "Used"
      },
      {
        value: totalSolarKWH,
        color: "rgba(0,250,0,0.5)",
        highlight: "rgba(0, 255, 0, 0.75)",
        label: "Solar"
      }
    ];

    todaysSolarVsGridPieChart = new Chart(solarVsUsagePie).Pie(solarVsUsageData);
  };

  function drawAverageHourlyUsageGraph(hour, usedKWH, solarKWH)
  {
    Chart.defaults.global.responsive = true;
    Chart.defaults.global.maintainAspectRatio = true;
    Chart.defaults.global.tooltipTitleFontSize = 14;
    Chart.defaults.global.tooltipFontSize = 12;
    Chart.defaults.global.scaleFontColor = "#444444";
    Chart.defaults.global.scaleLineColor = "#dddddd";
    Chart.defaults.global.scaleGridLineColor = "#cccccc";

    var averageHourlyUsageGraph = document.getElementById('averageHourlyUsageGraph').getContext('2d');
    var averageHourlyUsageData = {
      labels: hour,
      datasets: [
          {
              label: "Used kWH",
              fillColor: "rgba(250,120,120,0.7)",
              strokeColor: "rgba(250,120,120,0.8)",
              highlightFill: "rgba(255,120,120,0.75)",
              highlightStroke: "rgba(255,120,120,1)",
              data: usedKWH
          },
          {
              label: "Solar kWH",
              fillColor: "rgba(120,250,120,0.7)",
              strokeColor: "rgba(120,250,120,0.8)",
              highlightFill: "rgba(120,255,120,0.75)",
              highlightStroke: "rgba(120,255,120,1)",
              data: solarKWH
          },
      ]
    };
    averageHourlyUsageChart = new Chart(averageHourlyUsageGraph).Bar(averageHourlyUsageData);
  };

</script>
</body>

</html>
